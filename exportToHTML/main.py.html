<html>
<head>
<title>main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">multiprocessing</span>

<span class="s0">import </span><span class="s1">torch  </span><span class="s2"># For Model</span>
<span class="s0">import </span><span class="s1">cv2  </span><span class="s2"># For Cam</span>
<span class="s0">import </span><span class="s1">time  </span><span class="s2"># Inference measuring</span>
<span class="s0">import </span><span class="s1">local_utils.Label_xtr </span><span class="s0">as </span><span class="s1">Label_xtr </span><span class="s2"># Custom Label Extractor TODO: Develop Extractor functions</span>
<span class="s0">import </span><span class="s1">random</span>

<span class="s2"># Parameter Wall TODO: Add argparse</span>
<span class="s1">debug = </span><span class="s0">True  </span><span class="s2"># Enable Function Outputs</span>
<span class="s1">one = </span><span class="s0">False</span>
<span class="s1">model_type = </span><span class="s3">&quot;v7_custom&quot;  </span><span class="s2"># Select from: v5s, v5m, v5n, v7, v7t, v5_custom, v7_custom</span>
<span class="s1">v5_custom_path = </span><span class="s3">&quot;C:/Users/GG/Desktop/Code/ML/Models/v5s_70/weights/best.pt&quot;  </span><span class="s2"># Path to a YOLOv5 model trained on a custom dataset</span>
<span class="s1">v7_custom_path = </span><span class="s3">&quot;prebuilts/custom/v7t_aqua/V2-512-90%/yolov7.pt&quot;  </span><span class="s2"># Path to a YOLOv7 model trained on a custom dataset</span>
<span class="s1">custom_yaml = </span><span class="s3">&quot;prebuilts/custom/v7t_aqua/data.yaml&quot;  </span><span class="s2"># Path to the custom dataset's data.yaml file</span>
<span class="s1">src = </span><span class="s3">&quot;Testing/testvid.mp4&quot;</span>
<span class="s1">min_conf = </span><span class="s4">0.4</span>
<span class="s1">pixel_threshold = </span><span class="s4">25</span>
<span class="s1">avg_fps = []  </span><span class="s2"># List for Calculating Average FPS at ending</span>
<span class="s2"># clr = lambda: (random.randint(0,255), random.randint(0,255), random.randint(0,255))</span>
<span class="s1">clr = </span><span class="s0">lambda</span><span class="s1">: (</span><span class="s4">0</span><span class="s0">,</span><span class="s4">255</span><span class="s0">,</span><span class="s4">0</span><span class="s1">)</span>

<span class="s0">def </span><span class="s1">infer(frame</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">debug=</span><span class="s0">False</span><span class="s1">):</span>

    <span class="s1">results = model(frame)  </span><span class="s2"># infer</span>
    <span class="s2"># extract and convert results to list</span>
    <span class="s1">dets = results.xyxy[</span><span class="s4">0</span><span class="s1">].tolist()</span>
    <span class="s2">#if debug: print(dets)</span>
    <span class="s0">return </span><span class="s1">dets</span>


<span class="s0">def </span><span class="s1">draw(dets</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">classes</span><span class="s0">, </span><span class="s1">debug=</span><span class="s0">True, </span><span class="s1">color=(</span><span class="s4">0</span><span class="s0">,</span><span class="s4">255</span><span class="s0">,</span><span class="s4">0</span><span class="s1">)):</span>
    <span class="s1">xy1 = (int(dets[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(dets[</span><span class="s4">1</span><span class="s1">]))  </span><span class="s2"># top left point</span>
    <span class="s1">xy2 = (int(dets[</span><span class="s4">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(dets[</span><span class="s4">3</span><span class="s1">]))  </span><span class="s2"># bottom right point</span>
    <span class="s1">conf</span><span class="s0">, </span><span class="s1">lbl = dets[</span><span class="s4">4</span><span class="s1">:]  </span><span class="s2"># confidence and output label</span>

    <span class="s1">cv2.rectangle(frame</span><span class="s0">, </span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">xy2</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># draw rectangle</span>
    <span class="s1">cv2.putText(frame</span><span class="s0">, </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">classes[int(lbl)]</span><span class="s0">}</span><span class="s3">: </span><span class="s0">{</span><span class="s1">conf</span><span class="s0">:</span><span class="s3">.2f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">cv2.FONT_HERSHEY_SIMPLEX</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)  </span><span class="s2"># write label and conf atop rectangle</span>
    <span class="s0">if </span><span class="s1">debug:</span>
        <span class="s1">print(</span><span class="s3">f&quot;Detection: </span><span class="s0">\n   </span><span class="s3">BBox: </span><span class="s0">{</span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">xy2</span><span class="s0">} \n   </span><span class="s3">Label: </span><span class="s0">{</span><span class="s1">classes[int(lbl)]</span><span class="s0">} \n   </span><span class="s3">Confidence: </span><span class="s0">{</span><span class="s1">conf</span><span class="s0">:</span><span class="s3">.2f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)  </span><span class="s2"># output info</span>
        <span class="s1">cx = (dets[</span><span class="s4">2</span><span class="s1">] + dets[</span><span class="s4">0</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of X</span>
        <span class="s1">cy = (dets[</span><span class="s4">3</span><span class="s1">] + dets[</span><span class="s4">1</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of Y</span>
        <span class="s1">cv2.circle(frame</span><span class="s0">, </span><span class="s1">(int(cx)</span><span class="s0">, </span><span class="s1">int(cy))</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=color</span><span class="s0">, </span><span class="s1">thickness=-</span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">draw_1(dets</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">classes</span><span class="s0">, </span><span class="s1">debug=</span><span class="s0">True, </span><span class="s1">color=(</span><span class="s4">0</span><span class="s0">,</span><span class="s4">255</span><span class="s0">,</span><span class="s4">0</span><span class="s1">)):</span>
    <span class="s1">xy1 = (int(dets[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(dets[</span><span class="s4">1</span><span class="s1">]))  </span><span class="s2"># top left point</span>
    <span class="s1">xy2 = (int(dets[</span><span class="s4">2</span><span class="s1">])</span><span class="s0">, </span><span class="s1">int(dets[</span><span class="s4">3</span><span class="s1">]))  </span><span class="s2"># bottom right point</span>
    <span class="s1">conf</span><span class="s0">, </span><span class="s1">lbl = dets[</span><span class="s4">4</span><span class="s1">:]  </span><span class="s2"># confidence and output label</span>

    <span class="s1">cv2.rectangle(frame</span><span class="s0">, </span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">xy2</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s4">3</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># draw rectangle</span>
    <span class="s1">cv2.putText(frame</span><span class="s0">, </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">classes[int(lbl)]</span><span class="s0">}</span><span class="s3">: </span><span class="s0">{</span><span class="s1">conf</span><span class="s0">:</span><span class="s3">.2f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s0">, </span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">cv2.FONT_HERSHEY_SIMPLEX</span><span class="s0">, </span><span class="s4">1</span><span class="s0">, </span><span class="s1">color</span><span class="s0">, </span><span class="s4">2</span><span class="s1">)  </span><span class="s2"># write label and conf atop rectangle</span>
    <span class="s0">if </span><span class="s1">debug:</span>
        <span class="s1">print(</span><span class="s3">f&quot;Detection: </span><span class="s0">\n   </span><span class="s3">BBox: </span><span class="s0">{</span><span class="s1">xy1</span><span class="s0">, </span><span class="s1">xy2</span><span class="s0">} \n   </span><span class="s3">Label: </span><span class="s0">{</span><span class="s1">classes[int(lbl)]</span><span class="s0">} \n   </span><span class="s3">Confidence: </span><span class="s0">{</span><span class="s1">conf</span><span class="s0">:</span><span class="s3">.2f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)  </span><span class="s2"># output info</span>
        <span class="s1">cx = (dets[</span><span class="s4">2</span><span class="s1">] + dets[</span><span class="s4">0</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of X</span>
        <span class="s1">cy = (dets[</span><span class="s4">3</span><span class="s1">] + dets[</span><span class="s4">1</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of Y</span>
        <span class="s1">cv2.circle(frame</span><span class="s0">, </span><span class="s1">(int(cx)</span><span class="s0">, </span><span class="s1">int(cy))</span><span class="s0">, </span><span class="s4">5</span><span class="s0">, </span><span class="s1">color=color</span><span class="s0">, </span><span class="s1">thickness=-</span><span class="s4">1</span><span class="s1">)</span>


<span class="s0">def </span><span class="s1">pos_servo(dets</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">px=</span><span class="s4">25</span><span class="s1">):</span>
    <span class="s2">#from adafruit_servokit import ServoKit</span>
    <span class="s2">#pca = ServoKit(channels=8)</span>
    <span class="s1">detX = (dets[</span><span class="s4">2</span><span class="s1">] + dets[</span><span class="s4">0</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of X</span>
    <span class="s1">detY = (dets[</span><span class="s4">3</span><span class="s1">] + dets[</span><span class="s4">1</span><span class="s1">]) / </span><span class="s4">2  </span><span class="s2"># Center of Y</span>
    <span class="s1">ccy</span><span class="s0">, </span><span class="s1">ccx = [x/</span><span class="s4">2 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">frame.shape[:</span><span class="s4">2</span><span class="s1">]]</span>

    <span class="s0">if </span><span class="s1">ccx&lt;detX-px: xServ = </span><span class="s3">'-'</span>
    <span class="s0">elif </span><span class="s1">ccx&gt;detX+px: xServ = </span><span class="s3">'+'</span>
    <span class="s0">else</span><span class="s1">: xServ = </span><span class="s3">&quot;X axis is Centered&quot;</span>

    <span class="s0">if </span><span class="s1">ccy&lt;detY-px: yServ = </span><span class="s3">'-'</span>
    <span class="s0">elif </span><span class="s1">ccy&gt;detY+px: yServ = </span><span class="s3">'+'</span>
    <span class="s0">else</span><span class="s1">: yServ = </span><span class="s3">&quot;Y axis is Centered&quot;</span>

    <span class="s0">return </span><span class="s1">[xServ</span><span class="s0">, </span><span class="s1">yServ]</span>


<span class="s0">def </span><span class="s1">frame_debug(frame</span><span class="s0">, </span><span class="s1">px=</span><span class="s4">25</span><span class="s1">):</span>
    <span class="s1">cy</span><span class="s0">, </span><span class="s1">cx = frame.shape[:</span><span class="s4">2</span><span class="s1">]</span>
    <span class="s1">ccx = int(cx/</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">ccy = int(cy/</span><span class="s4">2</span><span class="s1">)</span>
    <span class="s1">cv2.rectangle(frame</span><span class="s0">, </span><span class="s1">(ccx-px</span><span class="s0">, </span><span class="s1">ccy-px)</span><span class="s0">, </span><span class="s1">(ccx+px</span><span class="s0">, </span><span class="s1">ccy+px)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">255</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)</span>

    <span class="s1">cv2.line(frame</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">ccy)</span><span class="s0">, </span><span class="s1">(ccx-px</span><span class="s0">, </span><span class="s1">ccy)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">255</span><span class="s1">)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># left line</span>
    <span class="s1">cv2.line(frame</span><span class="s0">, </span><span class="s1">(ccx</span><span class="s0">, </span><span class="s4">0</span><span class="s1">)</span><span class="s0">, </span><span class="s1">(ccx</span><span class="s0">, </span><span class="s1">ccy-px)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">255</span><span class="s1">)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># upper line</span>
    <span class="s1">cv2.line(frame</span><span class="s0">, </span><span class="s1">(ccx+px</span><span class="s0">, </span><span class="s1">ccy)</span><span class="s0">, </span><span class="s1">(cx</span><span class="s0">, </span><span class="s1">ccy)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">255</span><span class="s1">)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># right line</span>
    <span class="s1">cv2.line(frame</span><span class="s0">, </span><span class="s1">(ccx</span><span class="s0">, </span><span class="s1">ccy+px)</span><span class="s0">, </span><span class="s1">(ccx</span><span class="s0">, </span><span class="s1">cy)</span><span class="s0">, </span><span class="s1">(</span><span class="s4">0</span><span class="s0">, </span><span class="s4">0</span><span class="s0">, </span><span class="s4">255</span><span class="s1">)</span><span class="s0">, </span><span class="s4">2</span><span class="s0">, </span><span class="s1">cv2.LINE_AA)  </span><span class="s2"># lower line</span>


<span class="s0">if </span><span class="s1">__name__ == </span><span class="s3">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s0">if True</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">model_type == </span><span class="s3">'v5m'</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">&quot;ultralytics/yolov5&quot;</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s3">&quot;prebuilts/yolov5m.pt&quot;</span><span class="s0">, </span><span class="s1">verbose=debug)</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">'v5s'</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">&quot;ultralytics/yolov5&quot;</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s3">&quot;prebuilts/yolov5s.pt&quot;</span><span class="s0">, </span><span class="s1">verbose=debug)</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">'v5n'</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">&quot;ultralytics/yolov5&quot;</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s3">&quot;prebuilts/yolov5n.pt&quot;</span><span class="s0">, </span><span class="s1">verbose=debug)</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">&quot;v5_custom&quot;</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">'ultralytics/yolov5'</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s1">v5_custom_path</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># YoloV7 Tiny Model</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">'v7'</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">'yolov7'</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s3">&quot;prebuilts/yolov7.pt&quot;</span><span class="s0">, </span><span class="s1">source=</span><span class="s3">'local'</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># YoloV7 Tiny Model</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">'v7t'</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">'yolov7'</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s3">&quot;prebuilts/yolov7t.pt&quot;</span><span class="s0">, </span><span class="s1">source=</span><span class="s3">'local'</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># YoloV7 Tiny Model</span>

        <span class="s0">elif </span><span class="s1">model_type == </span><span class="s3">&quot;v7_custom&quot;</span><span class="s1">:</span>
            <span class="s1">model = torch.hub.load(</span><span class="s3">'yolov7'</span><span class="s0">, </span><span class="s3">'custom'</span><span class="s0">, </span><span class="s1">v7_custom_path</span><span class="s0">, </span><span class="s1">source=</span><span class="s3">'local'</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># YoloV7 Tiny Model</span>

        <span class="s2"># Extract classes from file</span>
        <span class="s0">if not </span><span class="s1">model_type.endswith(</span><span class="s3">&quot;custom&quot;</span><span class="s1">):</span>
            <span class="s1">classes = Label_xtr.getLabelsFromTxt(path=</span><span class="s3">&quot;coco-lbl.txt&quot;</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># Coco Labels Extract</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">classes = Label_xtr.getLabelsFromYaml(custom_yaml</span><span class="s0">, </span><span class="s1">verbose=debug)  </span><span class="s2"># AquaTrash Labels</span>
            <span class="s2">#classes = Label_xtr.getLabelsFromYaml(custom_yaml, verbose=debug)  # Trash-Filter Labels</span>
            <span class="s2">#classes = ['-', 'cardboard', 'glass', 'metal', 'plastic'] #Manual Labels</span>



        <span class="s2"># Open Webcam</span>
        <span class="s1">vid = cv2.VideoCapture(src)</span>
        <span class="s1">fourcc = cv2.VideoWriter_fourcc(*</span><span class="s3">'XVID'</span><span class="s1">)</span>
        <span class="s1">out = cv2.VideoWriter(</span><span class="s3">'Soji-DNN-Out.avi'</span><span class="s0">, </span><span class="s1">fourcc</span><span class="s0">, </span><span class="s4">80.0</span><span class="s0">, </span><span class="s1">(int(vid.get(cv2.CAP_PROP_FRAME_WIDTH))</span><span class="s0">, </span><span class="s1">int(vid.get(cv2.CAP_PROP_FRAME_HEIGHT))))</span>
        <span class="s0">while </span><span class="s1">vid.isOpened():</span>
            <span class="s1">start_time = time.time()</span>
            <span class="s1">ret</span><span class="s0">, </span><span class="s1">frame = vid.read()  </span><span class="s2"># read webcam image info</span>
            <span class="s1">detections = infer(frame</span><span class="s0">, </span><span class="s1">model</span><span class="s0">, </span><span class="s1">debug=debug)  </span><span class="s2"># goto infer function atop</span>

            <span class="s1">confs = []</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range(len(detections)):</span>
                <span class="s2"># Show Webcam Image with Detection Info</span>
                <span class="s0">if not </span><span class="s1">one:</span>
                    <span class="s0">if </span><span class="s1">detections[i][</span><span class="s4">4</span><span class="s1">] &gt;= min_conf:</span>
                        <span class="s1">draw(detections[i]</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">classes</span><span class="s0">, </span><span class="s1">debug=debug</span><span class="s0">, </span><span class="s1">color=clr())</span>
                <span class="s1">confs.append(detections[i][</span><span class="s4">4</span><span class="s1">])</span>

            <span class="s0">if </span><span class="s1">confs:</span>
                <span class="s1">most_conf_det = confs.index(max(confs))</span>
                <span class="s0">if </span><span class="s1">one: draw_1(detections[most_conf_det]</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">classes</span><span class="s0">, </span><span class="s1">debug=debug</span><span class="s0">, </span><span class="s1">color=clr())</span>

                <span class="s0">if </span><span class="s1">debug:</span>
                    <span class="s1">mcd_frame_adj = pos_servo(detections[most_conf_det]</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">pixel_threshold)</span>
                    <span class="s0">if </span><span class="s1">mcd_frame_adj[</span><span class="s4">0</span><span class="s1">] == </span><span class="s3">'+'</span><span class="s1">:</span>
                        <span class="s1">x = </span><span class="s3">&quot;Left&quot;</span>
                    <span class="s0">elif </span><span class="s1">mcd_frame_adj[</span><span class="s4">0</span><span class="s1">] == </span><span class="s3">'-'</span><span class="s1">:</span>
                        <span class="s1">x = </span><span class="s3">&quot;Right&quot;</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">x = </span><span class="s3">&quot;&quot;</span>
                    <span class="s0">if </span><span class="s1">mcd_frame_adj[</span><span class="s4">1</span><span class="s1">] == </span><span class="s3">'-'</span><span class="s1">:</span>
                        <span class="s1">y = </span><span class="s3">&quot;Lower&quot;</span>
                    <span class="s0">elif </span><span class="s1">mcd_frame_adj[</span><span class="s4">1</span><span class="s1">] == </span><span class="s3">'+'</span><span class="s1">:</span>
                        <span class="s1">y = </span><span class="s3">&quot;Upper&quot;</span>
                    <span class="s0">else</span><span class="s1">:</span>
                        <span class="s1">y = </span><span class="s3">&quot;&quot;</span>
                    <span class="s2"># if x == y == &quot;&quot;:</span>
                    <span class="s2"># grab()</span>
                    <span class="s0">if </span><span class="s1">detections[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">is not None</span><span class="s1">: print(</span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">detections[most_conf_det][</span><span class="s4">4</span><span class="s1">]</span><span class="s0">:</span><span class="s3">.3f</span><span class="s0">}</span><span class="s3">: </span><span class="s0">{</span><span class="s1">classes[int(detections[most_conf_det][</span><span class="s4">5</span><span class="s1">])]</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)</span>
                    <span class="s1">frame_debug(frame</span><span class="s0">, </span><span class="s1">pixel_threshold)</span>

            <span class="s1">cv2.imshow(</span><span class="s3">&quot;Model Modified Output&quot;</span><span class="s0">, </span><span class="s1">frame)</span>
            <span class="s1">out.write(frame)</span>
            <span class="s2"># FrameRate calculations</span>
            <span class="s0">if </span><span class="s1">debug:</span>
                <span class="s1">fps = </span><span class="s4">1 </span><span class="s1">/ (time.time() - start_time)</span>
                <span class="s1">avg_fps.append(fps)</span>
                <span class="s1">print(</span><span class="s3">f&quot;FPS: </span><span class="s0">{</span><span class="s1">fps</span><span class="s0">:</span><span class="s3">.3f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">cv2.waitKey(</span><span class="s4">1</span><span class="s1">) &amp; </span><span class="s4">0xFF </span><span class="s1">== ord(</span><span class="s3">'q'</span><span class="s1">): </span><span class="s0">break  </span><span class="s2"># stop process if q is pressed</span>
    <span class="s0">else</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s1">debug: print(</span><span class="s3">f&quot;Average FrameRate: </span><span class="s0">{</span><span class="s1">sum(avg_fps)/len(avg_fps)</span><span class="s0">:</span><span class="s3">.3f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)</span>
        <span class="s1">vid.release()</span>
        <span class="s1">out.release()</span>
        <span class="s1">cv2.destroyAllWindows()</span>
</pre>
</body>
</html>